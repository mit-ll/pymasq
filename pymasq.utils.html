<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pymasq.utils package &mdash; pymasq 1.0 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> pymasq
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="readme.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">pymasq</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pymasq</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>pymasq.utils package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/pymasq.utils.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pymasq-utils-package">
<h1>pymasq.utils package<a class="headerlink" href="#pymasq-utils-package" title="Permalink to this headline"></a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline"></a></h2>
</section>
<section id="module-pymasq.utils.cache">
<span id="pymasq-utils-cache-module"></span><h2>pymasq.utils.cache module<a class="headerlink" href="#module-pymasq.utils.cache" title="Permalink to this headline"></a></h2>
<dl class="py function">
<dt id="pymasq.utils.cache.cache_info">
<code class="sig-prename descclassname">pymasq.utils.cache.</code><code class="sig-name descname">cache_info</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">file_or_path</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span> &#x2192; Dict<span class="p">[</span>str<span class="p">, </span>str<span class="p">]</span><a class="headerlink" href="#pymasq.utils.cache.cache_info" title="Permalink to this definition"></a></dt>
<dd><p>Checks the hmac of a stored file (or directory of files) and then prints the
descriptive header stored in it (if any). The descriptions are printed only
if the hmac of the file matches the one generated using pymasq.confif.hm</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>file_or_path</strong> (<em>str</em>) – The full path to a specific file, or if a directory is given.
All files ending in “.pkl” are examined, but only those with a valid
hmac are loaded.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul>
<li><p><em>Dict[str,str]</em> –</p>
<dl class="simple">
<dt>str:</dt><dd><p>the name of the file in storage</p>
</dd>
<dt>str:</dt><dd><p>The description stored with the file</p>
</dd>
</dl>
</li>
<li><p><em>Files without valid hmacs are not listed.</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pymasq.utils.cache.df_to_filename_prefix">
<code class="sig-prename descclassname">pymasq.utils.cache.</code><code class="sig-name descname">df_to_filename_prefix</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">df</span><span class="p">:</span> <span class="n">pandas.core.frame.DataFrame</span></em>, <em class="sig-param"><span class="n">suffix</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">path</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>pathlib.Path<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">'.'</span></em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#pymasq.utils.cache.df_to_filename_prefix" title="Permalink to this definition"></a></dt>
<dd><p>This method produces a consistent file name (including path) for a given DF. Note that two data frames that differ
only in the order of their rows, rather than the content of the rows, will have the same result.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>pd.Dataframe</em>) – A dataframe.</p></li>
<li><p><strong>path</strong> (<em>cache location</em>) – </p></li>
<li><p><strong>suffix</strong> (<em>name</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The name of the file, including the path.
The dataframe, <cite>df</cite>, is not modified.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pymasq.utils.cache.load_cache">
<code class="sig-prename descclassname">pymasq.utils.cache.</code><code class="sig-name descname">load_cache</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">prefix_path</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>pathlib.Path<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">verbose</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">0</span></em>, <em class="sig-param"><span class="n">ignore_hmac</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span> &#x2192; Tuple<span class="p">[</span>Optional<span class="p">[</span>object<span class="p">]</span><span class="p">, </span>Optional<span class="p">[</span>str<span class="p">]</span><span class="p">]</span><a class="headerlink" href="#pymasq.utils.cache.load_cache" title="Permalink to this definition"></a></dt>
<dd><p>This method loads the cached pickle file of trained classifier from df to self.trained.
It checks the contents of the file against the hmac stored in the filename, and it will
not load unless the hmac is valid (Unless ignore_hmac is True).  The key for the hmac is
stored in pymasq.config.CACHE_HMAC_KEY.</p>
<p>In pymasq, often the cache file represents a model trained from a dataframe. The hash of the
dataframe is the prefix of the cache file. The suffix is the hmac of the trained model. Therefore,
when a cache is loaded, the suffix of the file is unknown to the method calling load_cache(). Therefore
this method attempts to load all cache files that have the prefix. Mismatching hmacs do not raise an
exception and instead simply print an error. Cache files that have a valid hmac but cannot be loaded
do raise an exception.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prefix_path</strong> (<em>str</em>) – The path to a cached file to be loaded.</p></li>
<li><p><strong>verbose</strong> (<em>int</em><em>, </em><em>optional</em><em> (</em><em>Default: 0</em><em>)</em>) – 0 disables verbose logging
1 (or higher) enables verbose logging</p></li>
<li><p><strong>ignore_hmac</strong> (<em>book</em><em> (</em><em>Defaut: False</em><em>)</em>) – If true, a failed hmac is ignored and the data is loaded (which is not a secure option).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>object</em> – The stored object</p></li>
<li><p><em>str</em> – A description that was stored with the object when it was saved.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pymasq.utils.cache.save">
<code class="sig-prename descclassname">pymasq.utils.cache.</code><code class="sig-name descname">save</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">object</span></em>, <em class="sig-param"><span class="n">cache_location</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>pathlib.Path<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">fn_prefix</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>str<span class="p">, </span>pathlib.Path<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">description</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>str<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">0</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pymasq.utils.cache.save" title="Permalink to this definition"></a></dt>
<dd><p>This method saves the already trained model of the given dataframe to a cached pickle file.
The hmac of the pickled data (including the description) becomes the suffix of cached filename. The key for the hmac is
stored in pymasq.config.CACHE_HMAC_KEY.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>object</em>) – A data accepted by pickle</p></li>
<li><p><strong>cache_location</strong> (<em>str</em>) – The cache_location of the file</p></li>
<li><p><strong>fn_prefix</strong> (<em>str</em>) – This is the prefix of the cached filename. The suffix will be based on an hmac</p></li>
<li><p><strong>verbose</strong> (<em>int</em><em>, </em><em>optional</em><em> (</em><em>Default:0</em><em>)</em>) – 0 disables verbose logging
1 (or higher) enables verbose logging</p></li>
<li><p><strong>descriptions</strong> (<em>str</em><em>, </em><em>optional</em><em> (</em><em>Default: None</em><em>)</em>) – A string saved with the pickle file.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Name of the cached file</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pymasq.utils.utils">
<span id="pymasq-utils-utils-module"></span><h2>pymasq.utils.utils module<a class="headerlink" href="#module-pymasq.utils.utils" title="Permalink to this headline"></a></h2>
<dl class="py function">
<dt id="pymasq.utils.utils.as_dataframe">
<code class="sig-prename descclassname">pymasq.utils.utils.</code><code class="sig-name descname">as_dataframe</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">obj</span></em>, <em class="sig-param"><span class="n">cols</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Union<span class="p">[</span>List<span class="p">, </span>str<span class="p">, </span>int<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pymasq.utils.utils.as_dataframe" title="Permalink to this definition"></a></dt>
<dd><p>Convert an object data structure into a DataFrame</p>
</dd></dl>

<dl class="py function">
<dt id="pymasq.utils.utils.formatting">
<code class="sig-prename descclassname">pymasq.utils.utils.</code><code class="sig-name descname">formatting</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">on_output</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em>, <em class="sig-param"><span class="n">ignore_dtypes</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pymasq.utils.utils.formatting" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="pymasq.utils.utils.freq_calc">
<code class="sig-prename descclassname">pymasq.utils.utils.</code><code class="sig-name descname">freq_calc</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span><span class="p">:</span> <span class="n">pandas.core.frame.DataFrame</span></em>, <em class="sig-param"><span class="n">sensitive_col</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>int<span class="p">, </span>str<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">quasi_cols</span><span class="p">:</span> <span class="n">List<span class="p">[</span>Union<span class="p">[</span>int<span class="p">, </span>str<span class="p">]</span><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">weights</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>List<span class="p">[</span>float<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pymasq.utils.utils.freq_calc" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>pd.DataFrame</em>) – dataFrame of the data for which the frequency counts are being calculated</p></li>
<li><p><strong>cols</strong> (<em>string</em><em> or </em><em>list of strings</em><em>, </em><em>optional</em><em> (</em><em>Default: None</em><em>)</em>) – name of one or more columns for which frequency is being counted</p></li>
<li><p><strong>sensitive_col</strong> (<em>str</em>) – The name of the column containing the data that is being obscured by mitigations</p></li>
<li><p><strong>= list of floats</strong><strong>, </strong><strong>optional</strong><strong> (</strong><strong>Default</strong> (<em>weights</em>) – the proportion of rows with the same combination of values in <cite>cols</cite> for
each row in <cite>data</cite>, only to be used if <cite>data</cite> is a sample.
If None, weights will be a column of ones indicating that this sample is the population)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dataframe with columns ‘samp_fq’ for sample frequency and ‘pop_fq’ for population frequency</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>DataFrame</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>InputError:</strong> – This error is raised when invalid arguments are passed.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>TODO</p>
</dd></dl>

<dl class="py function">
<dt id="pymasq.utils.utils.validate_numeric">
<code class="sig-prename descclassname">pymasq.utils.utils.</code><code class="sig-name descname">validate_numeric</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">on_input</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em>, <em class="sig-param"><span class="n">on_output</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pymasq.utils.utils.validate_numeric" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-pymasq.utils">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-pymasq.utils" title="Permalink to this headline"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MITLL.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>